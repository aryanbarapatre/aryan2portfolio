import{_ as N}from"./@babel-34ca84e8.js";import{r as u}from"./react-ba0062d6.js";import{L as xe,T as Lt,R as Ft,U as zt,s as at,a as Wt,O as He,P as Ie,S as Ye,b as Ce,B as Ht,M as It,C as $t,V as B,c as Bt,W as Ut,d as Nt,e as Gt,f as qt,g as Vt,h as Xt,N as Yt,A as Zt,i as Kt,j as Jt,D as Qt,k as be,l as $e,m as er,E as ct,n as tr,o as rr,p as nr,q as ae,r as or,t as ir,u as sr}from"./three-c67857be.js";import{u as ar}from"./react-use-measure-c5565719.js";import{F as cr,u as lr}from"./its-fine-e2e948df.js";import{R as ur,c as se}from"./react-reconciler-5057fb47.js";import{s as Ze}from"./scheduler-04ce0582.js";import{c as fr}from"./react-dom-c466ccab.js";import{c as lt}from"./zustand-96d19ac0.js";import"./maath-7cbc658b.js";import"./@react-spring-7eb7369e.js";import"./lodash.pick-4ed993c7.js";import{D as dr,G as Be,a as pr,M as Se,O as mr}from"./three-stdlib-5145b780.js";import"./lodash.omit-4ed993c7.js";import"./stats.js-4ed993c7.js";import{m as Ue}from"./react-merge-refs-239dbb3c.js";import"./react-composer-7eb7369e.js";import{s as vr,p as hr,c as gr}from"./suspend-react-00b64780.js";const Ne={},yr=e=>void Object.assign(Ne,e);function br(e,t){function r(n,{args:o=[],attach:p,...d},g){let M=`${n[0].toUpperCase()}${n.slice(1)}`,y;if(n==="primitive"){if(d.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const l=d.object;y=oe(l,{type:n,root:g,attach:p,primitive:!0})}else{const l=Ne[M];if(!l)throw new Error(`R3F: ${M} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(o))throw new Error("R3F: The args prop must be an array!");y=oe(new l(...o),{type:n,root:g,attach:p,memoizedProps:{args:o}})}return y.__r3f.attach===void 0&&(y instanceof Ht?y.__r3f.attach="geometry":y instanceof It&&(y.__r3f.attach="material")),M!=="inject"&&Re(y,d),y}function i(n,o){let p=!1;if(o){var d,g;(d=o.__r3f)!=null&&d.attach?Oe(n,o,o.__r3f.attach):o.isObject3D&&n.isObject3D&&(n.add(o),p=!0),p||(g=n.__r3f)==null||g.objects.push(o),o.__r3f||oe(o,{}),o.__r3f.parent=n,ze(o),ie(o)}}function s(n,o,p){let d=!1;if(o){var g,M;if((g=o.__r3f)!=null&&g.attach)Oe(n,o,o.__r3f.attach);else if(o.isObject3D&&n.isObject3D){o.parent=n,o.dispatchEvent({type:"added"});const y=n.children.filter(f=>f!==o),l=y.indexOf(p);n.children=[...y.slice(0,l),o,...y.slice(l)],d=!0}d||(M=n.__r3f)==null||M.objects.push(o),o.__r3f||oe(o,{}),o.__r3f.parent=n,ze(o),ie(o)}}function c(n,o,p=!1){n&&[...n].forEach(d=>v(o,d,p))}function v(n,o,p){if(o){var d,g,M;if(o.__r3f&&(o.__r3f.parent=null),(d=n.__r3f)!=null&&d.objects&&(n.__r3f.objects=n.__r3f.objects.filter(_=>_!==o)),(g=o.__r3f)!=null&&g.attach)tt(n,o,o.__r3f.attach);else if(o.isObject3D&&n.isObject3D){var y;n.remove(o),(y=o.__r3f)!=null&&y.root&&Sr(o.__r3f.root,o)}const f=(M=o.__r3f)==null?void 0:M.primitive,b=p===void 0?o.dispose!==null&&!f:p;if(!f){var l;c((l=o.__r3f)==null?void 0:l.objects,o,b),c(o.children,o,b)}o.__r3f&&(delete o.__r3f.root,delete o.__r3f.objects,delete o.__r3f.handlers,delete o.__r3f.memoizedProps,f||delete o.__r3f),b&&o.dispose&&o.type!=="Scene"&&Ze.unstable_scheduleCallback(Ze.unstable_IdlePriority,()=>{try{o.dispose()}catch{}}),ie(n)}}function m(n,o,p,d){var g;const M=(g=n.__r3f)==null?void 0:g.parent;if(!M)return;const y=r(o,p,n.__r3f.root);if(n.children){for(const l of n.children)l.__r3f&&i(y,l);n.children=n.children.filter(l=>!l.__r3f)}n.__r3f.objects.forEach(l=>i(y,l)),n.__r3f.objects=[],n.__r3f.autoRemovedBeforeAppend||v(M,n),y.parent&&(y.__r3f.autoRemovedBeforeAppend=!0),i(M,y),y.raycast&&y.__r3f.eventCount&&y.__r3f.root.getState().internal.interaction.push(y),[d,d.alternate].forEach(l=>{l!==null&&(l.stateNode=y,l.ref&&(typeof l.ref=="function"?l.ref(y):l.ref.current=y))})}const a=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:ur({createInstance:r,removeChild:v,appendChild:i,appendInitialChild:i,insertBefore:s,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(n,o)=>{if(!o)return;const p=n.getState().scene;p.__r3f&&(p.__r3f.root=n,i(p,o))},removeChildFromContainer:(n,o)=>{o&&v(n.getState().scene,o)},insertInContainerBefore:(n,o,p)=>{if(!o||!p)return;const d=n.getState().scene;d.__r3f&&s(d,o,p)},getRootHostContext:()=>null,getChildHostContext:n=>n,finalizeInitialChildren(n){var o;return!!((o=n==null?void 0:n.__r3f)!=null?o:{}).handlers},prepareUpdate(n,o,p,d){if(n.__r3f.primitive&&d.object&&d.object!==n)return[!0];{const{args:g=[],children:M,...y}=d,{args:l=[],children:f,...b}=p;if(!Array.isArray(g))throw new Error("R3F: the args prop must be an array!");if(g.some((E,P)=>E!==l[P]))return[!0];const _=ht(n,y,b,!0);return _.changes.length?[!1,_]:null}},commitUpdate(n,[o,p],d,g,M,y){o?m(n,d,M,y):Re(n,p)},commitMount(n,o,p,d){var g;const M=(g=n.__r3f)!=null?g:{};n.raycast&&M.handlers&&M.eventCount&&n.__r3f.root.getState().internal.interaction.push(n)},getPublicInstance:n=>n,prepareForCommit:()=>null,preparePortalMount:n=>oe(n.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(n){var o;const{attach:p,parent:d}=(o=n.__r3f)!=null?o:{};p&&d&&tt(d,n,p),n.isObject3D&&(n.visible=!1),ie(n)},unhideInstance(n,o){var p;const{attach:d,parent:g}=(p=n.__r3f)!=null?p:{};d&&g&&Oe(g,n,d),(n.isObject3D&&o.visible==null||o.visible)&&(n.visible=!0),ie(n)},createTextInstance:a,hideTextInstance:a,unhideTextInstance:a,getCurrentEventPriority:()=>t?t():se.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&T.fun(performance.now)?performance.now:T.fun(Date.now)?Date.now:()=>0,scheduleTimeout:T.fun(setTimeout)?setTimeout:void 0,cancelTimeout:T.fun(clearTimeout)?clearTimeout:void 0}),applyProps:Re}}var Ke,Je;const ut=()=>{var e;return(e=Ne.ColorManagement)!=null?e:null},ft=e=>e&&e.isOrthographicCamera,wr=e=>e&&e.hasOwnProperty("current"),ve=typeof window<"u"&&((Ke=window.document)!=null&&Ke.createElement||((Je=window.navigator)==null?void 0:Je.product)==="ReactNative")?u.useLayoutEffect:u.useEffect;function dt(e){const t=u.useRef(e);return ve(()=>void(t.current=e),[e]),t}function _r({set:e}){return ve(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class pt extends u.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}pt.getDerivedStateFromError=()=>({error:!0});const mt="__default",Qe=new Map,Er=e=>e&&!!e.memoized&&!!e.changes;function vt(e){const t=typeof window<"u"?window.devicePixelRatio:1;return Array.isArray(e)?Math.min(Math.max(e[0],t),e[1]):e}const fe=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()},T={obj:e=>e===Object(e)&&!T.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:r="shallow",objects:i="reference",strict:s=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(T.str(e)||T.num(e))return e===t;const c=T.obj(e);if(c&&i==="reference")return e===t;const v=T.arr(e);if(v&&r==="reference")return e===t;if((v||c)&&e===t)return!0;let m;for(m in e)if(!(m in t))return!1;if(c&&r==="shallow"&&i==="shallow"){for(m in s?t:e)if(!T.equ(e[m],t[m],{strict:s,objects:"reference"}))return!1}else for(m in s?t:e)if(e[m]!==t[m])return!1;if(T.und(m)){if(v&&e.length===0&&t.length===0||c&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function Mr(e){const t={nodes:{},materials:{}};return e&&e.traverse(r=>{r.name&&(t.nodes[r.name]=r),r.material&&!t.materials[r.material.name]&&(t.materials[r.material.name]=r.material)}),t}function Pr(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function oe(e,t){const r=e;return(t!=null&&t.primitive||!r.__r3f)&&(r.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t}),e}function Fe(e,t){let r=e;if(t.includes("-")){const i=t.split("-"),s=i.pop();return r=i.reduce((c,v)=>c[v],e),{target:r,key:s}}else return{target:r,key:t}}const et=/-\d+$/;function Oe(e,t,r){if(T.str(r)){if(et.test(r)){const c=r.replace(et,""),{target:v,key:m}=Fe(e,c);Array.isArray(v[m])||(v[m]=[])}const{target:i,key:s}=Fe(e,r);t.__r3f.previousAttach=i[s],i[s]=t}else t.__r3f.previousAttach=r(e,t)}function tt(e,t,r){var i,s;if(T.str(r)){const{target:c,key:v}=Fe(e,r),m=t.__r3f.previousAttach;m===void 0?delete c[v]:c[v]=m}else(i=t.__r3f)==null||i.previousAttach==null||i.previousAttach(e,t);(s=t.__r3f)==null||delete s.previousAttach}function ht(e,{children:t,key:r,ref:i,...s},{children:c,key:v,ref:m,...a}={},h=!1){var n;const o=(n=e==null?void 0:e.__r3f)!=null?n:{},p=Object.entries(s),d=[];if(h){const M=Object.keys(a);for(let y=0;y<M.length;y++)s.hasOwnProperty(M[y])||p.unshift([M[y],mt+"remove"])}p.forEach(([M,y])=>{var l;if((l=e.__r3f)!=null&&l.primitive&&M==="object"||T.equ(y,a[M]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(M))return d.push([M,y,!0,[]]);let f=[];M.includes("-")&&(f=M.split("-")),d.push([M,y,!1,f]);for(const b in s){const _=s[b];b.startsWith(`${M}-`)&&d.push([b,_,!1,b.split("-")])}});const g={...s};return o.memoizedProps&&o.memoizedProps.args&&(g.args=o.memoizedProps.args),o.memoizedProps&&o.memoizedProps.attach&&(g.attach=o.memoizedProps.attach),{memoized:g,changes:d}}function Re(e,t){var r,i,s;const c=(r=e.__r3f)!=null?r:{},v=c.root,m=(i=v==null||v.getState==null?void 0:v.getState())!=null?i:{},{memoized:a,changes:h}=Er(t)?t:ht(e,t),n=c.eventCount;e.__r3f&&(e.__r3f.memoizedProps=a);for(let p=0;p<h.length;p++){let[d,g,M,y]=h[p],l=e,f=l[d];if(y.length&&(f=y.reduce((b,_)=>b[_],e),!(f&&f.set))){const[b,..._]=y.reverse();l=_.reverse().reduce((E,P)=>E[P],e),d=b}if(g===mt+"remove")if(l.constructor){let b=Qe.get(l.constructor);b||(b=new l.constructor,Qe.set(l.constructor,b)),g=b[d]}else g=0;if(M)g?c.handlers[d]=g:delete c.handlers[d],c.eventCount=Object.keys(c.handlers).length;else if(f&&f.set&&(f.copy||f instanceof xe)){if(Array.isArray(g))f.fromArray?f.fromArray(g):f.set(...g);else if(f.copy&&g&&g.constructor&&f.constructor===g.constructor)f.copy(g);else if(g!==void 0){const b=f instanceof $t;!b&&f.setScalar?f.setScalar(g):f instanceof xe&&g instanceof xe?f.mask=g.mask:f.set(g),!ut()&&!m.linear&&b&&f.convertSRGBToLinear()}}else l[d]=g,!m.linear&&l[d]instanceof Lt&&l[d].format===Ft&&l[d].type===zt&&(l[d].encoding=at);ie(e)}if(c.parent&&m.internal&&e.raycast&&n!==c.eventCount){const p=m.internal.interaction.indexOf(e);p>-1&&m.internal.interaction.splice(p,1),c.eventCount&&m.internal.interaction.push(e)}return!(h.length===1&&h[0][0]==="onUpdate")&&h.length&&(s=e.__r3f)!=null&&s.parent&&ze(e),e}function ie(e){var t,r;const i=(t=e.__r3f)==null||(r=t.root)==null||r.getState==null?void 0:r.getState();i&&i.internal.frames===0&&i.invalidate()}function ze(e){e.onUpdate==null||e.onUpdate(e)}function xr(e,t){e.manual||(ft(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function we(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function Cr(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return se.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return se.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return se.ContinuousEventPriority;default:return se.DefaultEventPriority}}function gt(e,t,r,i){const s=r.get(t);s&&(r.delete(t),r.size===0&&(e.delete(i),s.target.releasePointerCapture(i)))}function Sr(e,t){const{internal:r}=e.getState();r.interaction=r.interaction.filter(i=>i!==t),r.initialHits=r.initialHits.filter(i=>i!==t),r.hovered.forEach((i,s)=>{(i.eventObject===t||i.object===t)&&r.hovered.delete(s)}),r.capturedMap.forEach((i,s)=>{gt(r.capturedMap,t,i,s)})}function Or(e){function t(a){const{internal:h}=e.getState(),n=a.offsetX-h.initialClick[0],o=a.offsetY-h.initialClick[1];return Math.round(Math.sqrt(n*n+o*o))}function r(a){return a.filter(h=>["Move","Over","Enter","Out","Leave"].some(n=>{var o;return(o=h.__r3f)==null?void 0:o.handlers["onPointer"+n]}))}function i(a,h){const n=e.getState(),o=new Set,p=[],d=h?h(n.internal.interaction):n.internal.interaction;for(let l=0;l<d.length;l++){const f=fe(d[l]);f&&(f.raycaster.camera=void 0)}n.previousRoot||n.events.compute==null||n.events.compute(a,n);function g(l){const f=fe(l);if(!f||!f.events.enabled||f.raycaster.camera===null)return[];if(f.raycaster.camera===void 0){var b;f.events.compute==null||f.events.compute(a,f,(b=f.previousRoot)==null?void 0:b.getState()),f.raycaster.camera===void 0&&(f.raycaster.camera=null)}return f.raycaster.camera?f.raycaster.intersectObject(l,!0):[]}let M=d.flatMap(g).sort((l,f)=>{const b=fe(l.object),_=fe(f.object);return!b||!_?l.distance-f.distance:_.events.priority-b.events.priority||l.distance-f.distance}).filter(l=>{const f=we(l);return o.has(f)?!1:(o.add(f),!0)});n.events.filter&&(M=n.events.filter(M,n));for(const l of M){let f=l.object;for(;f;){var y;(y=f.__r3f)!=null&&y.eventCount&&p.push({...l,eventObject:f}),f=f.parent}}if("pointerId"in a&&n.internal.capturedMap.has(a.pointerId))for(let l of n.internal.capturedMap.get(a.pointerId).values())o.has(we(l.intersection))||p.push(l.intersection);return p}function s(a,h,n,o){const p=e.getState();if(a.length){const d={stopped:!1};for(const g of a){const M=fe(g.object)||p,{raycaster:y,pointer:l,camera:f,internal:b}=M,_=new B(l.x,l.y,0).unproject(f),E=O=>{var w,C;return(w=(C=b.capturedMap.get(O))==null?void 0:C.has(g.eventObject))!=null?w:!1},P=O=>{const w={intersection:g,target:h.target};b.capturedMap.has(O)?b.capturedMap.get(O).set(g.eventObject,w):b.capturedMap.set(O,new Map([[g.eventObject,w]])),h.target.setPointerCapture(O)},R=O=>{const w=b.capturedMap.get(O);w&&gt(b.capturedMap,g.eventObject,w,O)};let S={};for(let O in h){let w=h[O];typeof w!="function"&&(S[O]=w)}let x={...g,...S,pointer:l,intersections:a,stopped:d.stopped,delta:n,unprojectedPoint:_,ray:y.ray,camera:f,stopPropagation(){const O="pointerId"in h&&b.capturedMap.get(h.pointerId);if((!O||O.has(g.eventObject))&&(x.stopped=d.stopped=!0,b.hovered.size&&Array.from(b.hovered.values()).find(w=>w.eventObject===g.eventObject))){const w=a.slice(0,a.indexOf(g));c([...w,g])}},target:{hasPointerCapture:E,setPointerCapture:P,releasePointerCapture:R},currentTarget:{hasPointerCapture:E,setPointerCapture:P,releasePointerCapture:R},nativeEvent:h};if(o(x),d.stopped===!0)break}}return a}function c(a){const{internal:h}=e.getState();for(const n of h.hovered.values())if(!a.length||!a.find(o=>o.object===n.object&&o.index===n.index&&o.instanceId===n.instanceId)){const p=n.eventObject.__r3f,d=p==null?void 0:p.handlers;if(h.hovered.delete(we(n)),p!=null&&p.eventCount){const g={...n,intersections:a};d.onPointerOut==null||d.onPointerOut(g),d.onPointerLeave==null||d.onPointerLeave(g)}}}function v(a,h){for(let n=0;n<h.length;n++){const o=h[n].__r3f;o==null||o.handlers.onPointerMissed==null||o.handlers.onPointerMissed(a)}}function m(a){switch(a){case"onPointerLeave":case"onPointerCancel":return()=>c([]);case"onLostPointerCapture":return h=>{const{internal:n}=e.getState();"pointerId"in h&&n.capturedMap.has(h.pointerId)&&requestAnimationFrame(()=>{n.capturedMap.has(h.pointerId)&&(n.capturedMap.delete(h.pointerId),c([]))})}}return function(n){const{onPointerMissed:o,internal:p}=e.getState();p.lastEvent.current=n;const d=a==="onPointerMove",g=a==="onClick"||a==="onContextMenu"||a==="onDoubleClick",y=i(n,d?r:void 0),l=g?t(n):0;a==="onPointerDown"&&(p.initialClick=[n.offsetX,n.offsetY],p.initialHits=y.map(b=>b.eventObject)),g&&!y.length&&l<=2&&(v(n,p.interaction),o&&o(n)),d&&c(y);function f(b){const _=b.eventObject,E=_.__r3f,P=E==null?void 0:E.handlers;if(E!=null&&E.eventCount)if(d){if(P.onPointerOver||P.onPointerEnter||P.onPointerOut||P.onPointerLeave){const R=we(b),S=p.hovered.get(R);S?S.stopped&&b.stopPropagation():(p.hovered.set(R,b),P.onPointerOver==null||P.onPointerOver(b),P.onPointerEnter==null||P.onPointerEnter(b))}P.onPointerMove==null||P.onPointerMove(b)}else{const R=P[a];R?(!g||p.initialHits.includes(_))&&(v(n,p.interaction.filter(S=>!p.initialHits.includes(S))),R(b)):g&&p.initialHits.includes(_)&&v(n,p.interaction.filter(S=>!p.initialHits.includes(S)))}}s(y,n,l,f)}}return{handlePointer:m}}const yt=e=>!!(e!=null&&e.render),bt=u.createContext(null),Rr=(e,t)=>{const r=lt((m,a)=>{const h=new B,n=new B,o=new B;function p(l=a().camera,f=n,b=a().size){const{width:_,height:E,top:P,left:R}=b,S=_/E;f instanceof B?o.copy(f):o.set(...f);const x=l.getWorldPosition(h).distanceTo(o);if(ft(l))return{width:_/l.zoom,height:E/l.zoom,top:P,left:R,factor:1,distance:x,aspect:S};{const O=l.fov*Math.PI/180,w=2*Math.tan(O/2)*x,C=w*(_/E);return{width:C,height:w,top:P,left:R,factor:_/C,distance:x,aspect:S}}}let d;const g=l=>m(f=>({performance:{...f.performance,current:l}})),M=new Bt;return{set:m,get:a,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(l=1)=>e(a(),l),advance:(l,f)=>t(l,f,a()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new Kt,pointer:M,mouse:M,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const l=a();d&&clearTimeout(d),l.performance.current!==l.performance.min&&g(l.performance.min),d=setTimeout(()=>g(a().performance.max),l.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:p},setEvents:l=>m(f=>({...f,events:{...f.events,...l}})),setSize:(l,f,b,_,E)=>{const P=a().camera,R={width:l,height:f,top:_||0,left:E||0,updateStyle:b};m(S=>({size:R,viewport:{...S.viewport,...p(P,n,R)}}))},setDpr:l=>m(f=>{const b=vt(l);return{viewport:{...f.viewport,dpr:b,initialDpr:f.viewport.initialDpr||b}}}),setFrameloop:(l="always")=>{const f=a().clock;f.stop(),f.elapsedTime=0,l!=="never"&&(f.start(),f.elapsedTime=0),m(()=>({frameloop:l}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:u.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(l,f,b)=>{const _=a().internal;return _.priority=_.priority+(f>0?1:0),_.subscribers.push({ref:l,priority:f,store:b}),_.subscribers=_.subscribers.sort((E,P)=>E.priority-P.priority),()=>{const E=a().internal;E!=null&&E.subscribers&&(E.priority=E.priority-(f>0?1:0),E.subscribers=E.subscribers.filter(P=>P.ref!==l))}}}}}),i=r.getState();let s=i.size,c=i.viewport.dpr,v=i.camera;return r.subscribe(()=>{const{camera:m,size:a,viewport:h,gl:n,set:o}=r.getState();if(a!==s||h.dpr!==c){var p;s=a,c=h.dpr,xr(m,a),n.setPixelRatio(h.dpr);const d=(p=a.updateStyle)!=null?p:typeof HTMLCanvasElement<"u"&&n.domElement instanceof HTMLCanvasElement;n.setSize(a.width,a.height,d)}m!==v&&(v=m,o(d=>({viewport:{...d.viewport,...d.viewport.getCurrentViewport(m)}})))}),r.subscribe(m=>e(m)),r};let _e,jr=new Set,Ar=new Set,Tr=new Set;function je(e,t){if(e.size)for(const{callback:r}of e.values())r(t)}function de(e,t){switch(e){case"before":return je(jr,t);case"after":return je(Ar,t);case"tail":return je(Tr,t)}}let Ae,Te;function De(e,t,r){let i=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),Ae=t.internal.subscribers,_e=0;_e<Ae.length;_e++)Te=Ae[_e],Te.ref.current(Te.store.getState(),i,r);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function Dr(e){let t=!1,r,i,s;function c(a){i=requestAnimationFrame(c),t=!0,r=0,de("before",a);for(const n of e.values()){var h;s=n.store.getState(),s.internal.active&&(s.frameloop==="always"||s.internal.frames>0)&&!((h=s.gl.xr)!=null&&h.isPresenting)&&(r+=De(a,s))}if(de("after",a),r===0)return de("tail",a),t=!1,cancelAnimationFrame(i)}function v(a,h=1){var n;if(!a)return e.forEach(o=>v(o.store.getState()),h);(n=a.gl.xr)!=null&&n.isPresenting||!a.internal.active||a.frameloop==="never"||(a.internal.frames=Math.min(60,a.internal.frames+h),t||(t=!0,requestAnimationFrame(c)))}function m(a,h=!0,n,o){if(h&&de("before",a),n)De(a,n,o);else for(const p of e.values())De(a,p.store.getState());h&&de("after",a)}return{loop:c,invalidate:v,advance:m}}function wt(){const e=u.useContext(bt);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function $(e=r=>r,t){return wt()(e,t)}function he(e,t=0){const r=wt(),i=r.getState().internal.subscribe,s=dt(e);return ve(()=>i(s,t,r),[t,i,r]),null}function _t(e,t){return function(r,...i){const s=new r;return e&&e(s),Promise.all(i.map(c=>new Promise((v,m)=>s.load(c,a=>{a.scene&&Object.assign(a,Mr(a.scene)),v(a)},t,a=>m(new Error(`Could not load ${c}: ${a.message})`))))))}}function X(e,t,r,i){const s=Array.isArray(t)?t:[t],c=vr(_t(r,i),[e,...s],{equal:T.equ});return Array.isArray(t)?c:c[0]}X.preload=function(e,t,r){const i=Array.isArray(t)?t:[t];return hr(_t(r),[e,...i])};X.clear=function(e,t){const r=Array.isArray(t)?t:[t];return gr([e,...r])};const ce=new Map,{invalidate:rt,advance:nt}=Dr(ce),{reconciler:Me,applyProps:q}=br(ce,Cr),ne={objects:"shallow",strict:!1},kr=(e,t)=>{const r=typeof e=="function"?e(t):e;return yt(r)?r:new Ut({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function Lr(e,t){if(t)return t;if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:r,height:i,top:s,left:c}=e.parentElement.getBoundingClientRect();return{width:r,height:i,top:s,left:c}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0};return{width:0,height:0,top:0,left:0}}function Fr(e){const t=ce.get(e),r=t==null?void 0:t.fiber,i=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const s=typeof reportError=="function"?reportError:console.error,c=i||Rr(rt,nt),v=r||Me.createContainer(c,se.ConcurrentRoot,null,!1,null,"",s,null);t||ce.set(e,{fiber:v,store:c});let m,a=!1,h;return{configure(n={}){let{gl:o,size:p,scene:d,events:g,onCreated:M,shadows:y=!1,linear:l=!1,flat:f=!1,legacy:b=!1,orthographic:_=!1,frameloop:E="always",dpr:P=[1,2],performance:R,raycaster:S,camera:x,onPointerMissed:O}=n,w=c.getState(),C=w.gl;w.gl||w.set({gl:C=kr(o,e)});let U=w.raycaster;U||w.set({raycaster:U=new Wt});const{params:ee,...L}=S||{};if(T.equ(L,U,ne)||q(U,{...L}),T.equ(ee,U.params,ne)||q(U,{params:{...U.params,...ee}}),!w.camera||w.camera===h&&!T.equ(h,x,ne)){h=x;const F=x instanceof Nt,j=F?x:_?new He(0,0,0,0,.1,1e3):new Ie(75,0,.1,1e3);F||(j.position.z=5,x&&q(j,x),!w.camera&&!(x!=null&&x.rotation)&&j.lookAt(0,0,0)),w.set({camera:j})}if(!w.scene){let F;d instanceof Ye?F=d:(F=new Ye,d&&q(F,d)),w.set({scene:oe(F)})}if(!w.xr){const F=(k,te)=>{const le=c.getState();le.frameloop!=="never"&&nt(k,!0,le,te)},j=()=>{const k=c.getState();k.gl.xr.enabled=k.gl.xr.isPresenting,k.gl.xr.setAnimationLoop(k.gl.xr.isPresenting?F:null),k.gl.xr.isPresenting||rt(k)},W={connect(){const k=c.getState().gl;k.xr.addEventListener("sessionstart",j),k.xr.addEventListener("sessionend",j)},disconnect(){const k=c.getState().gl;k.xr.removeEventListener("sessionstart",j),k.xr.removeEventListener("sessionend",j)}};C.xr&&W.connect(),w.set({xr:W})}if(C.shadowMap){const F=C.shadowMap.enabled,j=C.shadowMap.type;if(C.shadowMap.enabled=!!y,T.boo(y))C.shadowMap.type=Ce;else if(T.str(y)){var V;const W={basic:Gt,percentage:qt,soft:Ce,variance:Vt};C.shadowMap.type=(V=W[y])!=null?V:Ce}else T.obj(y)&&Object.assign(C.shadowMap,y);(F!==C.shadowMap.enabled||j!==C.shadowMap.type)&&(C.shadowMap.needsUpdate=!0)}const D=ut();D&&("enabled"in D?D.enabled=!b:"legacyMode"in D&&(D.legacyMode=b));const Y=l?Xt:at,H=f?Yt:Zt;C.outputEncoding!==Y&&(C.outputEncoding=Y),C.toneMapping!==H&&(C.toneMapping=H),w.legacy!==b&&w.set(()=>({legacy:b})),w.linear!==l&&w.set(()=>({linear:l})),w.flat!==f&&w.set(()=>({flat:f})),o&&!T.fun(o)&&!yt(o)&&!T.equ(o,C,ne)&&q(C,o),g&&!w.events.handlers&&w.set({events:g(c)});const z=Lr(e,p);return T.equ(z,w.size,ne)||w.setSize(z.width,z.height,z.updateStyle,z.top,z.left),P&&w.viewport.dpr!==vt(P)&&w.setDpr(P),w.frameloop!==E&&w.setFrameloop(E),w.onPointerMissed||w.set({onPointerMissed:O}),R&&!T.equ(R,w.performance,ne)&&w.set(F=>({performance:{...F.performance,...R}})),m=M,a=!0,this},render(n){return a||this.configure(),Me.updateContainer(u.createElement(zr,{store:c,children:n,onCreated:m,rootElement:e}),v,null,()=>{}),c},unmount(){Et(e)}}}function zr({store:e,children:t,onCreated:r,rootElement:i}){return ve(()=>{const s=e.getState();s.set(c=>({internal:{...c.internal,active:!0}})),r&&r(s),e.getState().events.connected||s.events.connect==null||s.events.connect(i)},[]),u.createElement(bt.Provider,{value:e},t)}function Et(e,t){const r=ce.get(e),i=r==null?void 0:r.fiber;if(i){const s=r==null?void 0:r.store.getState();s&&(s.internal.active=!1),Me.updateContainer(null,i,null,()=>{s&&setTimeout(()=>{try{var c,v,m,a;s.events.disconnect==null||s.events.disconnect(),(c=s.gl)==null||(v=c.renderLists)==null||v.dispose==null||v.dispose(),(m=s.gl)==null||m.forceContextLoss==null||m.forceContextLoss(),(a=s.gl)!=null&&a.xr&&s.xr.disconnect(),Pr(s),ce.delete(e),t&&t(e)}catch{}},500)})}}Me.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:u.version});const ke={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Wr(e){const{handlePointer:t}=Or(e);return{priority:1,enabled:!0,compute(r,i,s){i.pointer.set(r.offsetX/i.size.width*2-1,-(r.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(ke).reduce((r,i)=>({...r,[i]:t(i)}),{}),update:()=>{var r;const{events:i,internal:s}=e.getState();(r=s.lastEvent)!=null&&r.current&&i.handlers&&i.handlers.onPointerMove(s.lastEvent.current)},connect:r=>{var i;const{set:s,events:c}=e.getState();c.disconnect==null||c.disconnect(),s(v=>({events:{...v.events,connected:r}})),Object.entries((i=c.handlers)!=null?i:[]).forEach(([v,m])=>{const[a,h]=ke[v];r.addEventListener(a,m,{passive:h})})},disconnect:()=>{const{set:r,events:i}=e.getState();if(i.connected){var s;Object.entries((s=i.handlers)!=null?s:[]).forEach(([c,v])=>{if(i&&i.connected instanceof HTMLElement){const[m]=ke[c];i.connected.removeEventListener(m,v)}}),r(c=>({events:{...c.events,connected:void 0}}))}}}}const Hr=u.forwardRef(function({children:t,fallback:r,resize:i,style:s,gl:c,events:v=Wr,eventSource:m,eventPrefix:a,shadows:h,linear:n,flat:o,legacy:p,orthographic:d,frameloop:g,dpr:M,performance:y,raycaster:l,camera:f,onPointerMissed:b,onCreated:_,...E},P){u.useMemo(()=>yr(Jt),[]);const R=lr(),[S,x]=ar({scroll:!0,debounce:{scroll:50,resize:0},...i}),O=u.useRef(null),w=u.useRef(null);u.useImperativeHandle(P,()=>O.current);const C=dt(b),[U,ee]=u.useState(!1),[L,V]=u.useState(!1);if(U)throw U;if(L)throw L;const D=u.useRef(null);ve(()=>{const H=O.current;x.width>0&&x.height>0&&H&&(D.current||(D.current=Fr(H)),D.current.configure({gl:c,events:v,shadows:h,linear:n,flat:o,legacy:p,orthographic:d,frameloop:g,dpr:M,performance:y,raycaster:l,camera:f,size:x,onPointerMissed:(...z)=>C.current==null?void 0:C.current(...z),onCreated:z=>{z.events.connect==null||z.events.connect(m?wr(m)?m.current:m:w.current),a&&z.setEvents({compute:(F,j)=>{const W=F[a+"X"],k=F[a+"Y"];j.pointer.set(W/j.size.width*2-1,-(k/j.size.height)*2+1),j.raycaster.setFromCamera(j.pointer,j.camera)}}),_==null||_(z)}}),D.current.render(u.createElement(R,null,u.createElement(pt,{set:V},u.createElement(u.Suspense,{fallback:u.createElement(_r,{set:ee})},t)))))}),u.useEffect(()=>{const H=O.current;if(H)return()=>Et(H)},[]);const Y=m?"none":"auto";return u.createElement("div",N({ref:w,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:Y,...s}},E),u.createElement("div",{ref:S,style:{width:"100%",height:"100%"}},u.createElement("canvas",{ref:O,style:{display:"block"}},r)))}),bn=u.forwardRef(function(t,r){return u.createElement(cr,null,u.createElement(Hr,N({},t,{ref:r})))}),ge=new B,Ge=new B,Ir=new B;function $r(e,t,r){const i=ge.setFromMatrixPosition(e.matrixWorld);i.project(t);const s=r.width/2,c=r.height/2;return[i.x*s+s,-(i.y*c)+c]}function Br(e,t){const r=ge.setFromMatrixPosition(e.matrixWorld),i=Ge.setFromMatrixPosition(t.matrixWorld),s=r.sub(i),c=t.getWorldDirection(Ir);return s.angleTo(c)>Math.PI/2}function Ur(e,t,r,i){const s=ge.setFromMatrixPosition(e.matrixWorld),c=s.clone();c.project(t),r.setFromCamera(c,t);const v=r.intersectObjects(i,!0);if(v.length){const m=v[0].distance;return s.distanceTo(r.ray.origin)<m}return!0}function Nr(e,t){if(t instanceof He)return t.zoom;if(t instanceof Ie){const r=ge.setFromMatrixPosition(e.matrixWorld),i=Ge.setFromMatrixPosition(t.matrixWorld),s=t.fov*Math.PI/180,c=r.distanceTo(i);return 1/(2*Math.tan(s/2)*c)}else return 1}function Gr(e,t,r){if(t instanceof Ie||t instanceof He){const i=ge.setFromMatrixPosition(e.matrixWorld),s=Ge.setFromMatrixPosition(t.matrixWorld),c=i.distanceTo(s),v=(r[1]-r[0])/(t.far-t.near),m=r[1]-v*t.far;return Math.round(v*c+m)}}const We=e=>Math.abs(e)<1e-10?0:e;function Mt(e,t,r=""){let i="matrix3d(";for(let s=0;s!==16;s++)i+=We(t[s]*e.elements[s])+(s!==15?",":")");return r+i}const qr=(e=>t=>Mt(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),Vr=(e=>(t,r)=>Mt(t,e(r),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function Xr(e){return e&&typeof e=="object"&&"current"in e}const wn=u.forwardRef(({children:e,eps:t=.001,style:r,className:i,prepend:s,center:c,fullscreen:v,portal:m,distanceFactor:a,sprite:h=!1,transform:n=!1,occlude:o,onOcclude:p,castShadow:d,receiveShadow:g,material:M,geometry:y,zIndexRange:l=[16777271,0],calculatePosition:f=$r,as:b="div",wrapperClass:_,pointerEvents:E="auto",...P},R)=>{const{gl:S,camera:x,scene:O,size:w,raycaster:C,events:U,viewport:ee}=$(),[L]=u.useState(()=>document.createElement(b)),V=u.useRef(),D=u.useRef(null),Y=u.useRef(0),H=u.useRef([0,0]),z=u.useRef(null),F=u.useRef(null),j=(m==null?void 0:m.current)||U.connected||S.domElement.parentNode,W=u.useRef(null),k=u.useRef(!1),te=u.useMemo(()=>o&&o!=="blending"||Array.isArray(o)&&o.length&&Xr(o[0]),[o]);u.useLayoutEffect(()=>{const I=S.domElement;o&&o==="blending"?(I.style.zIndex=`${Math.floor(l[0]/2)}`,I.style.position="absolute",I.style.pointerEvents="none"):(I.style.zIndex=null,I.style.position=null,I.style.pointerEvents=null)},[o]),u.useLayoutEffect(()=>{if(D.current){const I=V.current=fr(L);if(O.updateMatrixWorld(),n)L.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const A=f(D.current,x,w);L.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${A[0]}px,${A[1]}px,0);transform-origin:0 0;`}return j&&(s?j.prepend(L):j.appendChild(L)),()=>{j&&j.removeChild(L),I.unmount()}}},[j,n]),u.useLayoutEffect(()=>{_&&(L.className=_)},[_]);const le=u.useMemo(()=>n?{position:"absolute",top:0,left:0,width:w.width,height:w.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:c?"translate3d(-50%,-50%,0)":"none",...v&&{top:-w.height/2,left:-w.width/2,width:w.width,height:w.height},...r},[r,c,v,w,n]),St=u.useMemo(()=>({position:"absolute",pointerEvents:E}),[E]);u.useLayoutEffect(()=>{if(k.current=!1,n){var I;(I=V.current)==null||I.render(u.createElement("div",{ref:z,style:le},u.createElement("div",{ref:F,style:St},u.createElement("div",{ref:R,className:i,style:r,children:e}))))}else{var A;(A=V.current)==null||A.render(u.createElement("div",{ref:R,style:le,className:i,children:e}))}});const re=u.useRef(!0);he(I=>{if(D.current){x.updateMatrixWorld(),D.current.updateWorldMatrix(!0,!1);const A=n?H.current:f(D.current,x,w);if(n||Math.abs(Y.current-x.zoom)>t||Math.abs(H.current[0]-A[0])>t||Math.abs(H.current[1]-A[1])>t){const Z=Br(D.current,x);let G=!1;te&&(o!=="blending"?G=[O]:Array.isArray(o)&&(G=o.map(K=>K.current)));const ue=re.current;if(G){const K=Ur(D.current,x,C,G);re.current=K&&!Z}else re.current=!Z;ue!==re.current&&(p?p(!re.current):L.style.display=re.current?"block":"none");const ye=Math.floor(l[0]/2),Ot=o?te?[l[0],ye]:[ye-1,0]:l;if(L.style.zIndex=`${Gr(D.current,x,Ot)}`,n){const[K,Ve]=[w.width/2,w.height/2],Pe=x.projectionMatrix.elements[5]*Ve,{isOrthographicCamera:Xe,top:Rt,left:jt,bottom:At,right:Tt}=x,Dt=qr(x.matrixWorldInverse),kt=Xe?`scale(${Pe})translate(${We(-(Tt+jt)/2)}px,${We((Rt+At)/2)}px)`:`translateZ(${Pe}px)`;let J=D.current.matrixWorld;h&&(J=x.matrixWorldInverse.clone().transpose().copyPosition(J).scale(D.current.scale),J.elements[3]=J.elements[7]=J.elements[11]=0,J.elements[15]=1),L.style.width=w.width+"px",L.style.height=w.height+"px",L.style.perspective=Xe?"":`${Pe}px`,z.current&&F.current&&(z.current.style.transform=`${kt}${Dt}translate(${K}px,${Ve}px)`,F.current.style.transform=Vr(J,1/((a||10)/400)))}else{const K=a===void 0?1:Nr(D.current,x)*a;L.style.transform=`translate3d(${A[0]}px,${A[1]}px,0) scale(${K})`}H.current=A,Y.current=x.zoom}}if(!te&&W.current&&!k.current)if(n){if(z.current){const A=z.current.children[0];if(A!=null&&A.clientWidth&&A!=null&&A.clientHeight){const{isOrthographicCamera:Z}=x;if(Z||y)P.scale&&(Array.isArray(P.scale)?P.scale instanceof B?W.current.scale.copy(P.scale.clone().divideScalar(1)):W.current.scale.set(1/P.scale[0],1/P.scale[1],1/P.scale[2]):W.current.scale.setScalar(1/P.scale));else{const G=(a||10)/400,ue=A.clientWidth*G,ye=A.clientHeight*G;W.current.scale.set(ue,ye,1)}k.current=!0}}}else{const A=L.children[0];if(A!=null&&A.clientWidth&&A!=null&&A.clientHeight){const Z=1/ee.factor,G=A.clientWidth*Z,ue=A.clientHeight*Z;W.current.scale.set(G,ue,1),k.current=!0}W.current.lookAt(I.camera.position)}});const qe=u.useMemo(()=>({vertexShader:n?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom" 
            is false. 
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;
            
            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[n]);return u.createElement("group",N({},P,{ref:D}),o&&!te&&u.createElement("mesh",{castShadow:d,receiveShadow:g,ref:W},y||u.createElement("planeGeometry",null),M||u.createElement("shaderMaterial",{side:Qt,vertexShader:qe.vertexShader,fragmentShader:qe.fragmentShader})))});let pe=0;const _n=lt(e=>(be.onStart=(t,r,i)=>{e({active:!0,item:t,loaded:r,total:i,progress:(r-pe)/(i-pe)*100})},be.onLoad=()=>{e({active:!1})},be.onError=t=>e(r=>({errors:[...r.errors,t]})),be.onProgress=(t,r,i)=>{r===i&&(pe=i),e({active:!0,item:t,loaded:r,total:i,progress:(r-pe)/(i-pe)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0})),ot=e=>e===Object(e)&&!Array.isArray(e)&&typeof e!="function";function Pt(e,t){const r=$(s=>s.gl),i=X($e,ot(e)?Object.values(e):e);if(u.useLayoutEffect(()=>{t==null||t(i)},[t]),u.useEffect(()=>{(Array.isArray(i)?i:[i]).forEach(r.initTexture)},[r,i]),ot(e)){const s=Object.keys(e),c={};return s.forEach(v=>Object.assign(c,{[v]:i[s.indexOf(v)]})),c}else return i}Pt.preload=e=>X.preload($e,e);Pt.clear=e=>X.clear($e,e);function Yr(e){return Array.isArray(e)}function Le(e=[0,0,0]){return Yr(e)?e:e instanceof B||e instanceof ct?[e.x,e.y,e.z]:[e,e,e]}function En({debug:e,mesh:t,children:r,position:i,rotation:s,scale:c,...v}){const m=u.useRef(null),a=u.useRef(null);return u.useLayoutEffect(()=>{const h=(t==null?void 0:t.current)||m.current.parent,n=m.current;if(!(h instanceof er))throw new Error('Decal must have a Mesh as parent or specify its "mesh" prop');const o={position:new B,rotation:new ct,scale:new B(1,1,1)};if(h){q(o,{position:i,scale:c});const p=h.matrixWorld.clone();if(h.matrixWorld.identity(),!s||typeof s=="number"){const d=new tr;d.position.copy(o.position),d.lookAt(h.position),typeof s=="number"&&d.rotateZ(s),q(o,{rotation:d.rotation})}else q(o,{rotation:s});return n.geometry=new dr(h,o.position,o.rotation,o.scale),a.current&&q(a.current,o),h.matrixWorld=p,()=>{n.geometry.dispose()}}},[t,...Le(i),...Le(c),...Le(s)]),u.createElement("mesh",{ref:m},r||u.createElement("meshStandardMaterial",N({transparent:!0,polygonOffset:!0,polygonOffsetFactor:-10},v)),e&&u.createElement("mesh",{ref:a},u.createElement("boxGeometry",null),u.createElement("meshNormalMaterial",{wireframe:!0}),u.createElement("axesHelper",null)))}let Ee=null;function xt(e,t,r){return i=>{r&&r(i),e&&(Ee||(Ee=new pr),Ee.setDecoderPath(typeof e=="string"?e:"https://www.gstatic.com/draco/versioned/decoders/1.5.5/"),i.setDRACOLoader(Ee)),t&&i.setMeshoptDecoder(typeof Se=="function"?Se():Se)}}function Ct(e,t=!0,r=!0,i){return X(Be,e,xt(t,r,i))}Ct.preload=(e,t=!0,r=!0,i)=>X.preload(Be,e,xt(t,r,i));Ct.clear=e=>X.clear(Be,e);const Mn=u.forwardRef(({makeDefault:e,camera:t,regress:r,domElement:i,enableDamping:s=!0,onChange:c,onStart:v,onEnd:m,...a},h)=>{const n=$(E=>E.invalidate),o=$(E=>E.camera),p=$(E=>E.gl),d=$(E=>E.events),g=$(E=>E.setEvents),M=$(E=>E.set),y=$(E=>E.get),l=$(E=>E.performance),f=t||o,b=i||d.connected||p.domElement,_=u.useMemo(()=>new mr(f),[f]);return he(()=>{_.enabled&&_.update()},-1),u.useEffect(()=>(_.connect(b),()=>void _.dispose()),[b,r,_,n]),u.useEffect(()=>{const E=S=>{n(),r&&l.regress(),c&&c(S)},P=S=>{v&&v(S)},R=S=>{m&&m(S)};return _.addEventListener("change",E),_.addEventListener("start",P),_.addEventListener("end",R),()=>{_.removeEventListener("start",P),_.removeEventListener("end",R),_.removeEventListener("change",E)}},[c,v,m,_,n,g]),u.useEffect(()=>{if(e){const E=y().controls;return M({controls:_}),()=>M({controls:E})}},[e,_]),u.createElement("primitive",N({ref:h,object:_,enableDamping:s},a))});class Zr extends rr{constructor(t){super(t),this.onBeforeCompile=(r,i)=>{const{isWebGL2:s}=i.capabilities;r.fragmentShader=r.fragmentShader.replace("#include <output_fragment>",`
        ${s?"#include <output_fragment>":`#extension GL_OES_standard_derivatives : enable
#include <output_fragment>`}
      vec2 cxy = 2.0 * gl_PointCoord - 1.0;
      float r = dot(cxy, cxy);
      float delta = fwidth(r);     
      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);
      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );
      #include <tonemapping_fragment>
      #include <encodings_fragment>
      `)}}}const Pn=u.forwardRef((e,t)=>{const[r]=u.useState(()=>new Zr(null));return u.createElement("primitive",N({},e,{object:r,ref:t,attach:"material"}))}),xn=u.forwardRef(({children:e,speed:t=1,rotationIntensity:r=1,floatIntensity:i=1,floatingRange:s=[-.1,.1],...c},v)=>{const m=u.useRef(null),a=u.useRef(Math.random()*1e4);return he(h=>{var n,o;const p=a.current+h.clock.getElapsedTime();m.current.rotation.x=Math.cos(p/4*t)/8*r,m.current.rotation.y=Math.sin(p/4*t)/8*r,m.current.rotation.z=Math.sin(p/4*t)/20*r;let d=Math.sin(p/4*t)/10;d=nr.mapLinear(d,-.1,.1,(n=s==null?void 0:s[0])!==null&&n!==void 0?n:-.1,(o=s==null?void 0:s[1])!==null&&o!==void 0?o:.1),m.current.position.y=d*i}),u.createElement("group",c,u.createElement("group",{ref:Ue([m,v])},e))});let Q,me;const Kr=u.createContext(null),it=new or,st=new B,Jr=u.forwardRef(({children:e,range:t,limit:r=1e3,...i},s)=>{const c=u.useRef(null),[v,m]=u.useState([]),[[a,h,n]]=u.useState(()=>[new Float32Array(r*3),Float32Array.from({length:r*3},()=>1),Float32Array.from({length:r},()=>1)]);u.useEffect(()=>{c.current.geometry.attributes.position.needsUpdate=!0}),he(()=>{for(c.current.updateMatrix(),c.current.updateMatrixWorld(),it.copy(c.current.matrixWorld).invert(),c.current.geometry.drawRange.count=Math.min(r,t!==void 0?t:r,v.length),Q=0;Q<v.length;Q++)me=v[Q].current,me.getWorldPosition(st).applyMatrix4(it),st.toArray(a,Q*3),c.current.geometry.attributes.position.needsUpdate=!0,me.matrixWorldNeedsUpdate=!0,me.color.toArray(h,Q*3),c.current.geometry.attributes.color.needsUpdate=!0,n.set([me.size],Q),c.current.geometry.attributes.size.needsUpdate=!0});const o=u.useMemo(()=>({getParent:()=>c,subscribe:p=>(m(d=>[...d,p]),()=>m(d=>d.filter(g=>g.current!==p.current)))}),[]);return u.createElement("points",N({userData:{instances:v},matrixAutoUpdate:!1,ref:Ue([s,c]),raycast:()=>null},i),u.createElement("bufferGeometry",null,u.createElement("bufferAttribute",{attach:"attributes-position",count:a.length/3,array:a,itemSize:3,usage:ae}),u.createElement("bufferAttribute",{attach:"attributes-color",count:h.length/3,array:h,itemSize:3,usage:ae}),u.createElement("bufferAttribute",{attach:"attributes-size",count:n.length,array:n,itemSize:1,usage:ae})),u.createElement(Kr.Provider,{value:o},e))}),Qr=u.forwardRef(({children:e,positions:t,colors:r,sizes:i,stride:s=3,...c},v)=>{const m=u.useRef(null);return he(()=>{const a=m.current.geometry.attributes;a.position.needsUpdate=!0,r&&(a.color.needsUpdate=!0),i&&(a.size.needsUpdate=!0)}),u.createElement("points",N({ref:Ue([v,m])},c),u.createElement("bufferGeometry",null,u.createElement("bufferAttribute",{attach:"attributes-position",count:t.length/s,array:t,itemSize:s,usage:ae}),r&&u.createElement("bufferAttribute",{attach:"attributes-color",count:r.length/s,array:r,itemSize:3,usage:ae}),i&&u.createElement("bufferAttribute",{attach:"attributes-size",count:i.length/s,array:i,itemSize:1,usage:ae})),e)}),Cn=u.forwardRef((e,t)=>e.positions instanceof Float32Array?u.createElement(Qr,N({},e,{ref:t})):u.createElement(Jr,N({},e,{ref:t})));function Sn({all:e,scene:t,camera:r}){const i=$(({gl:v})=>v),s=$(({camera:v})=>v),c=$(({scene:v})=>v);return u.useLayoutEffect(()=>{const v=[];e&&(t||c).traverse(h=>{h.visible===!1&&(v.push(h),h.visible=!0)}),i.compile(t||c,r||s);const m=new ir(128);new sr(.01,1e5,m).update(i,t||c),m.dispose(),v.forEach(h=>h.visible=!1)},[]),null}export{bn as C,En as D,xn as F,wn as H,Mn as O,Sn as P,Ct as a,Pt as b,he as c,Cn as d,Pn as e,_n as u};
